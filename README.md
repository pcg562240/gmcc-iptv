# 用ai生成代码，实现每天自动获取广东移动iptv频道和节目表

基本0代码经验，现在ai太强大了，而广东移动iptv的获取方法虽然简单，但没找到有个完整的频道+节目表获取方法，因为这两天借助ai，编写了一个py代码，这个代码运行后，会自动下载频道列表，并分组成央视、广东、卫视、其他分组，生成一个tv.m3u（组播地址）和一个tv2.m3u（组播转单播地址，UDPXY地址可以直接在py文件的前面修改）。然后会下载两天的节目单，并生成t.xml和t.xml.gz文件（我用TiviMate软件播放iptv，支持这两种格式）
使用时发现AI现在真是太强大了，你问他一个代码，他不但会自动生成，还会拓展出你可能要的内容，我叫他提取频道，他自动给我分组了，我叫他自定义一下组播转单播地址，他还保留了epg输出地址等等，真是小白福音。


我自己生成的代码后面提供下载，以下是我用ai生成代码的过程，供感兴趣的坛友参考（自己写代码的大大就不要看了）


首先是思路：
广东移动的IPTV，可以不用抓包，直接通过iptv的wan下载json文件，里面有所有的频道。所以我们的步骤是下载这个文件回来，扔给ai分析怎样提取出我们需要的频道。
然后就是节目单，也有一个地址是可以获取的，不过就麻烦一点，他下载地址是由下载地址+频道ID+日期组成，只有今明两天的有数据，这个也可以告诉AI处理。
我们正式开始吧。


一、获取移动iptv的wan地址（以爱快为例，可以参考别的教程）

1、爱快新建一个wan口，绑定一个空闲网口，接入方法是dhcp，点开下方的高级设置，在克隆MAC里填上IPTV电视盒子的MAC（可以最后地址加1），正常将网线爱快这个WAN口和光猫的电视口，就会获取到移动的电视内网IP。（如果不行，可能你那里加密了，要抓包option12、60、61的数据，可以搜索其他教程）。如果你是单线的，参考单线复用教程（要光猫的超级密码）。

2、通过抓包可以发现，广东移动的频道，是可以直接通过wan3口这个地址（http://183.235.16.92:8082/epg/api/custom/getAllChannel2.json）来下载频道的，而且还有一个相同地址的getAllChannel.json，这个是标准的json格式，可以提取出所有频道的

3、先通过端口分流，把目标地址填上183.235.16.92，线路选择刚才建的wan口（wan3），这样就可以直接下载http://183.235.16.92:8082/epg/api/custom/getAllChannel.json

二、ai处理。我一开始是用deepseek的官方网站处理的，但问了半天，经常卡住，后来用马斯克的grok，发现速度贼快，后来也用grok了，基本都是这两家混用。理论上各ai大同小异，反正小白只需要结果对就可以了。

1、提取频道
下载频道列表文件后，开始问ai：我有一个json文件，文件名是getAllChannel.json，我想提取出里面的数据生成m3u文件（tv.m3u），请问怎样用python代码处理呢？以下是json前面的部分内容（复制前面内容，或者全部复制，如果你的ai支持长文本的话）
然后ai会告诉你代码，创建一个tv.py文件，把ai代码复制进去，然后自己运行一下python3 tv.py，正常的话会生成一个tv.m3u，里面是各个频道列表。

2、修正频道
如果你的ai不太聪明的样子，运行的结果报错，那就复制报错代码给他，他会自动修正。或者更好的方法是，指定格式给他，比如这样：
我有一个json文件，文件名是getAllChannel.json，我想提取出里面的数据生成m3u文件（tv.m3u），请问怎样用python代码处理呢？其中m3u格式如下：tvg-id=code，tvg-name=title，tvg-logo=icon tvg-logo="http://183.235.16.92:8081/pics/micro-picture/channelNew/02000000000000050000000000000055.png" group-title="央视",CCTV-1综合，播放地址是zteurl，例如生成的结果如下：
#EXTINF:-1 tvg-id="02000000000000050000000000000055" tvg-name="CCTV-1综合" tvg-logo="http://183.235.16.92:8081/pics/micro-picture/channelNew/02000000000000050000000000000055.png" group-title="央视",CCTV-1综合
rtp://239.10.0.202:1025
以下是json前面的部分内容
（复制前面内容，或者全部复制，如果你的ai支持长文本的话）
如果还报错，就复印报错的内容给ai，ai会自动修正代码，然后再运行，正常应该会得到一个频道列表

3、分组、排序列表
虽然得到列表，但这个列表的分组和顺序会比较乱，不同ai的分组会不一样，我试的ds会分成央视、卫视、其他，而grok会分成央视、广东（包括 "大湾区" "嘉佳" "南方" "岭南"）、卫视、其他，grok的分组合理，就直接用他的吧。
然后每组的频道再排序，你要告诉ai用自然排序，只告诉排序的话有些ai会把cctv11排在cctv1前面。以下是让ai写代码的内容：
刚才成功输出频道了，不过我想要适当的分组和排序，请用这个分组： 央视、广东（包括 "大湾区" "嘉佳" "南方" "岭南"）、卫视、其他。然后每个分组里的频道按自然数字排序。
然后就可以输出分组排序后的频道了（如果报错再把报错内容给ai，一些ai可能会要求安装python模块）

4、合并一开始的下载地址
前面的getAllChannel.json是我们自己下载，我们交给ai下载然后分析文件，不用保存在本地
问：getAllChannel.json这个文件的下载地址是http://183.235.16.92:8082/epg/api/custom/getAllChannel.json，你能在最前面加入下载，然后继续执行转换m3u代码吗？（这个文件不用下载到本地）

正常会合并下载文件到内存再处理。

5、组播转单播处理

刚才的文件，直接是组播地址，如果是单播呢？再叫ai修改代码：
刚才生成了tv.m3u文件，我想同时生成一个tv2.m3u文件，播放地址用http://10.10.10.253:3333/rtp/替换掉rtp://，其中替换地址是做成变量存在，在代码前面可以修改的，注释和文件输出时显示：你的组播转单播UDPXY地址是xxx
这样就是同时生成tv1.m3u，tv2.m3u，tv2.m3u是组播转单播地址，而且这个udpxy地址是可以随时修改的

6、其他信息
可以让ai生成相关信息，比如提示最后生成了多少个频道，导出的m3u显示真实路径。

三、获取节目表

1、移动IPTV节目表地址

移动的IPTV节目表地址如下：http://183.235.16.92:8082/epg/api/channel/（tvg-id代码）.json?begintime=（年月日）
替换tvg-id和后面的年月日，可以得到这个ID的某天节目单地址（只有今天和明天的有数据）
2、tvg-id之前生成频道列表的时候会有，所以可以扔给AI，叫他下载今天和明天的节目单，把所有数据都保存在一个文件里，我们把这个文件扔给AI，能成功处理出节目单了再叫他把数据保存在内存里不用输出文件

问： 我有个下载地址，http://183.235.16.92:8082/epg/api/channel/（tvg-id代码）.json?begintime=（今天和明天日期），你能在上述代码后面把这些下载地址都下载回来并保存到egp.json文件里吗
如果有报错，就把报错的内容复制给AI，会给出修正代码
如果没报错，会一大串提示正在下载刷屏，我们让AI继续修正一下：
刚才的代码可以运行，不过会显示很多正在下载……，你能去掉这个提示，改成进度显示吗？比如1/xxx，2/xxx

正常应该会有频道两倍数目的EPG，如果没有的话就再问问AI

3、提取epg.json转换成标准的xmltv格式（我是用TiviMate软件，所以用这个格式，如果你的播放器支持别的格式，你可以根据你的格式问AI）
问：上面下载的内容直接保存到内容不用保存到本地，然后帮我把这个json格式内容转换成标准的xmltv格式,以下是这个json的部分内容：
正常会转换成一个节目表epg.xml
这样基本就完成了所有工作，只需要运行一下，就可以自动生成频道和节目表

四、优化
我们添一下自定义的文件名，这样就可以随意改变输出的文件名，还用端口分流把组播的地址分流到wan3口去，我们还可以把这个py文件放在openwrt路由器里，每天运行，这次就会自动每天生成频道和节目表了

1、优化自定义输出
问：我想自定义输出的文件名，默认文件名是tv.m3u、tv2.m3u、t.xml（这个文件同时输出一份压缩文件t.xml.gz），优化一下结构，把自定义的内容都一起放在前面。你帮我修改一下代码

这样py文件上面就有几行是可自定义的内容，方便修改输出的文件名、udpxy地址，这样基本完成了
只要每一步都测试，然后给AI反馈，轻松的就可以让0代码能力的人得到自己想要的效果了，就像有个随身程序员一样。

2、端口分流
上次我们分流了获取频道文件的地址到wan，接下来把组播的IP分流到wan3，还可以把iptv盒子的ip分流到wan3，这样同时盒子也可以正常使用（要打开网络设置、IMGP代理才行）

3、定时运行
通过openwrt的计划任务，可以让这个程序每天凌晨2点运行，保持频道和节目都是最新的。
我是istoreos，自带了易有云，把tv.py文件上传到/iptv目录下，然后在系统、计划任务里，在后面写进：0 2 * * * cd /iptv && /usr/bin/python3 tv.py >> tv.log 2>&1
然后保存就可以了。想要改运行时间、频率，可以直接复制这行给AI，问他改成每天XX点，一天运行两次等该怎么写，会直接给你代码复制时来
